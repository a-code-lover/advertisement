# 代码整洁之道 (敏捷开发技艺)

## 序和前言

> "小处诚实非小事"  
> 神在细节之中。  
> 20世纪90年代末期有关仅以测试(TDD)和代码驱动设计的理念一去不返。  
> 整洁近乎虔诚。及时一针省九针。日事日毕。  
> **你当用为自己第一个孩子命名般的谨慎来给变量命名。**  
> 每首诗歌都无写完之时，得持续重写，直至放弃为止。  
> 知与行

## 整洁之道

> 态度，感觉  
> 高效，易于维护，逻辑清晰简单，没有重复代码，抽象，可扩展  
> “你还得练，孩子，还得练。”  

## 有意义的命名

1.**名副其实**：如果名称需要注释补充，那就不算是名副其实。  
2.**避免误导**：避免多义词，近似词，避免与本意相背的词。  
3.**做有意义的区分**：如a1，a1；Product,ProductInfo;添加数字或者废话完全没有提供作者意图的线索。  
4.使用读得出来的名称，便于交流。  
5.使用可搜索的名称。  
6.避免编码：如不用加类型（编译器会检查），不用成员前缀。  
7.类名事业使用名词，如Customer、WikiPage，避免使用Manager，Data，Info。方法名使用动词。  
8.每个概念使用一个词，保持一致性，如controller,manager,driver，选一即可。  
9.**添加有意义的语境**，不用没用的语境。  
10.先试解决方案领域名称，在试问题领域名称。  

## 函数

1.函数的第一规则是要短小。第二条规则是还要更短小。20行封顶最佳。if、else、while语句等，其中代码块应该只有一行。（真的？？？）  
2.**只做一件事。**  
3.**每个函数一个抽象层级**：要确保函数只做一件事，函数中的语句都要在同一抽象层上。我们希望那个让代码拥有自顶向下的阅读顺序，让每个函数后面都跟着下一抽象层级的函数。  
4.使用描述性名称：长而描述性的名称比短而令人费解的名称好。长而具有描述性的名称，要比描述性的长注释好。  
5.函数参数：应尽可能少，最好不超过三个。  
6.**无副作用**：避免对变量做出非预期的改动，输出参数（？）  
7.分隔指令与询问。  
8.使用异常代替返回错误码：好处是错误处理代码能从主路径代码中分离出来。最好将try和catch代码块的主体抽离出来，分别形成函数。  
9.DRY  
10.如何做到：先想到什么写什么，测试通过，再打磨。

> 思考：将一段代码拆分为多个函数，那么多函数调用会影响程序的效率吗？

## 注释

> 注释并不是“纯天然地好“。实际上，注释最多也就是一种必须的恶。若编程语言足够有表达力，或者我们长于使用这些语言来表达意图，就不那么需要注释——也许根本不需要。由于注释的更新常常滞后于代码，所有注释会撒谎。

1.注释不能美化糟糕的代码。  
2.用代码阐述：能用函数和变量就别用注释。
3.好的注释：

+ 法律信息：如果可能，尽量指向一份标准许可或其他外部文档。
+ 提供额外信息。
+ 对意图的解释。
+ 阐释：晦涩的参数或返回值，或者是标准库一部分，或者是不能改的代码，阐释其含义。
+ 警示。
+ TODO。

4.坏的注释：一大堆  

## 格式

1.垂直格式：行数200-500上限，垂直距离：概念越近距离越近，调用函数靠近。  
2.横向格式：字符80-120上限，不用拖动滚动条就好。空格缩进。
3.空范围：for,while语句体为空时，容易忽略分号，最好加空括号。
4.团队规则。

## 对象和数据结构

> 思考：添加赋值器和取值器不是破坏了数据的私有性吗？

1.数据抽象：隐藏实现并非只是在变量之间放上一个函数层那么简单，隐藏实现关乎抽象，以便用户无须了解数据的实现就能操作数据本体。  
2.过程式代码难以添加新的数据结构，因为必须修改所有函数，便以不修改数据结构下添加新函数；面向对象代码难以添加新函数，因为必须修改所有类，便于添加新类。  
3.The Law of Demeter（没理解？？？）  
4.数据传送对象：只有公共变量，没有函数的类。  

## 错误处理

1.使用异常而非返回码，Try-Catch-Finally。  
2.null：别返回null，别传递null。
